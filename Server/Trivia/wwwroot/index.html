<!DOCTYPE html>
<html>
<head>
    <title>SignalR Simple Chat</title>
    <style type="text/css">
        .container {
            background-color: #99CCFF;
            border: thick solid #808080;
            padding: 20px;
            margin: 20px;
        }
    </style>
</head>
<body>
<div class="container">
    <input type="text" id="message" />
    <input type="button" id="sendmessage" value="Send" />
    <input type="text" id="lobby" />
    <input type="button" id="joinlobby" value="Join Lobby" />
    <input type="button" id="createlobby" value="Create Lobby" />
    <input type="button" id="leaveLobby" value="Leave Lobby" />
    <ul id="discussion"></ul>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/3.1.7/signalr.min.js"></script>
<script type="text/javascript">
    document.addEventListener('DOMContentLoaded', function () {

        var messageInput = document.getElementById('message');
        var LobbyInput = document.getElementById('lobby');
        var name = prompt('Enter your name:', '');
        messageInput.focus();

        var connection = new signalR.HubConnectionBuilder()
            .withUrl('http://localhost:5000/triviaGameServer')
            .build();

        connection.on('broadcastMessage', function (name, message) {
            var encodedName = name;
            var encodedMsg = message;
            var liElement = document.createElement('li');
            liElement.innerHTML = '<strong>' + encodedName + '</strong>:&nbsp;&nbsp;' + encodedMsg;
            document.getElementById('discussion').appendChild(liElement);
        });

        connection.on('joinLobby', function (lobbyId, users) {
           console.log("joined lobby " + lobbyId);
           console.log(users);
        });

        connection.on('userJoinedLobby', function (user) {
            var liElement = document.createElement('li');
            liElement.innerHTML = '<strong>' + 'Server' + '</strong>:&nbsp;&nbsp;' + user + ' joined the lobby';
            document.getElementById('discussion').appendChild(liElement);
        });

        connection.on('userLeftLobby', function (user) {
            var liElement = document.createElement('li');
            liElement.innerHTML = '<strong>' + 'Server' + '</strong>:&nbsp;&nbsp;' + user + ' left the lobby';
            document.getElementById('discussion').appendChild(liElement);
        });

        connection.start()
            .then(function () {
                console.log('connection started');
                document.getElementById('sendmessage').addEventListener('click', function (event) {
                    connection.invoke('SendMessage', messageInput.value);

                    // Clear text box and reset focus for next comment.
                    messageInput.value = '';
                    messageInput.focus();
                    event.preventDefault();
                });

                document.getElementById('joinlobby').addEventListener('click', function (event) {
                    connection.invoke('joinLobby', name, LobbyInput.value);
                });

                document.getElementById('createlobby').addEventListener('click', function (event) {
                    connection.invoke('createLobby', name);
                });

                document.getElementById('leaveLobby').addEventListener('click', function (event) {
                    connection.invoke('LeaveLobby');
                });
                
                
                
            })
            .catch(error => {
                console.error(error.message);
            });
    });
</script>
</body>
</html>